(function(){var e,t,n;t=d3.time.format("%Y-%m-%d").parse,n=function(e,t){return"translate("+e+","+t+")"},e=137.508/180*Math.PI,app.timelineFocus=function(){var r,i,s,o,u,a,f;return u=null,a=960,s=200,r=[],f=d3.time.scale(),o=d3.scale.sqrt(),i=function(e){return u=e.each(function(i){var u,l,c,h;return f.domain(r).range([0,a]),c=f(d3.time.day.offset(r[0],1))-f.range()[0],h=d3.max(i,function(e){return e.values.length}),u=d3.scale.linear().domain([0,h]).range(["#fff","#f00"]),o.domain([0,h]).range([0,Math.min(s/2,c/2)]),l=e.selectAll(".group").data(i,function(e){return e.key}),l.enter().append("g").attr({"class":"group",transform:function(e){return n(f(d3.time.hour.offset(t(e.key),12)),s/2)}}).append("circle").attr({"class":"marker-sum",r:function(e){return o(e.values.length)}}),l.exit().remove()}),i},i.width=function(e){return arguments.length?(a=e,i):a},i.height=function(e){return arguments.length?(s=e,i):s},i.domain=function(e){var a;return arguments.length?(r=e,f.domain(r),a=f(d3.time.day.offset(r[0],1))-f.range()[0],o.range([0,Math.min(s/2,a/2)]),u!=null&&u.selectAll(".group").attr({transform:function(e){return n(f(t(e.key))+a/2,s/2)}}).select(".marker-sum").attr({r:function(e){return o(e.values.length)}}),i):r},i.brushstart=function(){var e;return e=d3.selectAll(".group.active").classed("active",!1),e.select(".marker-sum").transition().duration(100).attr("r",function(e){return o(e.values.length)}),e.selectAll(".detail").remove(),i},i.brushend=function(){var s,o;return o=d3.selectAll(".group").filter(function(e){var n;return n=d3.time.day(t(e.key)),d3.time.hour.offset(r[0],12).getTime()===n.getTime()}),o.classed("active",!0),o.select(".marker-sum").transition().duration(100).attr("r",0),s=o.selectAll(".detail").data(function(e){return e.values}),s.enter().append("circle").attr({"class":"detail",transform:function(t,r){var i,s,o;return s=r+1,i=s*e,o=8*Math.sqrt(s),n(Math.cos(i)*o,Math.sin(i)*o)},r:5}).style({opacity:0}),s.transition().duration(10).delay(function(e,t){return 100+t*1}).style({opacity:1}),i},i}}).call(this),function(){var e,t;e=d3.time.format("%Y-%m-%d").parse,t=function(e,t){return"translate("+e+","+t+")"},app.timelineContext=function(){var n,r,i,s,o,u,a;return u=960,o=100,s=[],i=d3.dispatch("brushstart","brush","brushend"),a=d3.time.scale(),n=d3.svg.brush().x(a).on("brushstart",i.brushstart).on("brushend",i.brushend).on("brush",function(){var e,t,r;n.empty()?i.brush(a.domain()):(t=n.extent(),r=d3.time.hour.offset(d3.time.day.floor(t[0]),-12),r<a.domain()[0]&&(r=a.domain()[0]),e=d3.time.day.offset(r,2),e>a.domain()[1]&&(e=a.domain()[1],r=d3.time.day.offset(e,-2)),n.extent([r,e]),i.brush(n.extent()))}),r=function(i){return i.each(function(r){var f,l,c,h;return a.domain(s).range([0,u]),c=a(d3.time.day.offset(s[0],1))-a.range()[0],l=d3.scale.linear().domain([0,maxPerDay]).range(["#fff","#f00"]),h=i.selectAll("rect").data(r,function(e){return e.key}),h.enter().append("rect").attr({transform:function(n){return t(a(e(n.key)),0)},height:o,width:c}).style({fill:function(e){return l(e.values.length)}}),h.exit().remove(),n.extent([a.domain()[0],d3.time.day.offset(a.domain()[0],2)]),f=i.selectAll(".brush").data([0]).enter().append("g").attr({"class":"brush"}).call(n),f.selectAll(".resize").remove(),f.selectAll(".background").style({background:"transparent"}),f.selectAll("rect").attr({height:o})}),r},r.width=function(e){return arguments.length?(u=e,r):u},r.height=function(e){return arguments.length?(o=e,r):o},r.domain=function(e){return arguments.length?(s=e,r):s},d3.rebind(r,i,"on"),r}}.call(this),function(){var e,t;e=d3.time.format("%Y-%m-%d").parse,t=function(e,t){return"translate("+e+","+t+")"},app.timeline=function(){var n,r,i,s,o;return o=960,i=300,r=app.timelineFocus().width(o).height(260),n=app.timelineContext().width(o).height(30).on("brush",r.domain).on("brushstart",r.brushstart).on("brushend",r.brushend),s=function(u){return u.each(function(s){var u,a,f,l;return s.forEach(function(e){return e.timespan=+e.timespan}),a=d3.extent(s,function(t){return e(t.tax_freedom_day)}),s=s.filter(function(e){return e.gross_income==="100000"&&e.social_group==="1"}),u=d3.nest().key(function(e){return e.tax_freedom_day}).entries(s),f=d3.select(this).selectAll("svg").data([0]),l=f.enter().append("svg").attr({width:o,height:i}),l.append("g").attr({"class":"timeline-focus"}),l.append("g").attr({"class":"timeline-context",transform:t(0,i-n.height())}),n.domain(a),f.select(".timeline-context").datum(u).call(n),r.domain(n.domain()),f.select(".timeline-focus").datum(u).call(r)}),s},s.width=function(e){return arguments.length?(o=e,s):o},s.height=function(e){return arguments.length?(i=e,s):i},s}}.call(this);