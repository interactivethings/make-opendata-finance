(function(){function k(e){var t=+(e=="e"),n=t?1:-1,r=u/3;return"M"+.5*n+","+r+"A6,6 0 0 "+t+" "+6.5*n+","+(r+6)+"V"+(2*r-6)+"A6,6 0 0 "+t+" "+.5*n+","+2*r+"Z"+"M"+2.5*n+","+(r+8)+"V"+(2*r-8)+"M"+4.5*n+","+(r+8)+"V"+(2*r-8)}function L(){A(),M()}function A(){O()}function O(e){_.each(f,function(e){l=d3.time.days(new XDate(e,0,1),new XDate(e+1,0,1))}),_.each(l,function(e){e.date=new XDate(e),e.municipalities=1}),c=d3.min(l,function(e){return e.date}),h=d3.max(l,function(e){return e.date}),p=d3.max(l,function(e){return e.municipalities})}function M(){v.data(l),v(T),j()}function D(){var e=[],n=function(n){g.domain(d3.extent(l.map(function(e){return e}))),b.domain([0,p]),m.domain(d3.extent(e.map(function(e){return e}))),y.domain([0,p]),d=m(d3.time.day.offset(c,1));var r=N.selectAll(".day").data(e);r.enter().append("rect").attr("class","day").attr("clip-path","url(#clip)").attr("x",function(e){return m(e.date)-d}).attr("y",function(e){return 50}).attr("width",d).attr("height",50).style("fill","slategray");var i=C.selectAll(".day-context").data(e);i.enter().append("rect").attr("class","day-context").attr("x",function(e){return g(e.date)-d}).attr("y",function(e){return o+t}).attr("width",d).attr("height",20).style("fill","silver");var s=C.select(".x.brush").node();s.parentNode.appendChild(s),N.select(".x.axis.focus-axis").transition().call(w),N.select(".y.axis.focus-axis").transition().duration(750).call(E),C.select(".x.axis.context-axis").transition().call(S)};return n.data=function(t){return arguments.length?(e=t,n):e},n}function P(){T.classed("selecting",!0)}function H(){m.domain(x.empty()?g.domain():x.extent()),N.select(".x.axis").call(w),d=m(d3.time.day.offset(m.domain()[0],1)),N.selectAll(".day").attr("x",function(e){return m(e.date)-d}).attr("width",d)}function B(){T.classed("selecting",!d3.event.target.empty())}function j(){}var e=40,t=20,n={top:0,right:0,bottom:0,left:0},r={top:n.top,right:n.right,bottom:n.bottom+t,left:n.left+e},i={top:n.top,right:n.right,bottom:n.bottom+ +t,left:n.left+e},s=938-r.left-r.right,o=500-r.top-r.bottom,u=50+i.top+i.bottom,a=o+u+n.bottom,f=[2011],l=[],c,h,p,d,v=D(),m=d3.time.scale().range([0,s]),g=d3.time.scale().range([0,s]),y=d3.scale.linear().range([0,o/2]),b=d3.scale.linear().range([0,u/2]),w=d3.svg.axis().scale(m).orient("bottom"),E=d3.svg.axis().scale(y).orient("left").tickSize(-s),S=d3.svg.axis().scale(g).orient("bottom"),x=d3.svg.brush().x(g).on("brushstart",P).on("brush",H).on("brushend",B),T=d3.select("#chart").append("svg").attr("width",s+r.left+r.right).attr("height",a+r.top+r.bottom);T.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",s).attr("height",o);var N=T.append("g").attr("class","focus").attr("transform","translate("+r.left+","+r.top+")");N.append("g").attr("class","x axis focus-axis").attr("transform","translate(0,"+o+")"),N.append("g").attr("class","y axis earning_axis"),N.append("g").attr("class","y axis spending_axis").attr("transform","translate(0,"+o/2+")");var C=T.append("g").attr("class","context").attr("transform","translate("+i.left+","+i.top+")");C.append("g").attr("class","x axis context-axis").attr("transform","translate(0,"+(o+t+u)+")"),C.append("g").attr("class","x brush").call(x).selectAll("rect").attr("y",o+t).attr("height",u),C.selectAll(".resize").append("path").attr("transform","translate(0,"+(o+t)+")").attr("d",k),queue().defer(d3.csv,"/assets/data/fichier1.csv").await(function(e,t){e&&console.error("Noooo!",e),L()})})();