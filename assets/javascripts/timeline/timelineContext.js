(function(){var e,t;e=d3.time.format("%Y-%m-%d").parse,t=function(e,t){return"translate("+e+","+t+")"},app.timelineContext=function(){var n,r,i,s,o,u,a;return u=960,o=100,s=[],i=d3.dispatch("brushstart","brush","brushend"),a=d3.time.scale(),n=d3.svg.brush().x(a).on("brushstart",i.brushstart).on("brushend",i.brushend).on("brush",function(){var e,t,r;n.empty()?i.brush(a.domain()):(t=n.extent(),r=d3.time.hour.offset(d3.time.day.floor(t[0]),-12),r<a.domain()[0]&&(r=a.domain()[0]),e=d3.time.day.offset(r,2),e>a.domain()[1]&&(e=a.domain()[1],r=d3.time.day.offset(e,-2)),n.extent([r,e]),i.brush(n.extent()))}),r=function(i){return i.each(function(r){var f,l,c,h;return a.domain(s).range([0,u]),c=a(d3.time.day.offset(s[0],1))-a.range()[0],l=d3.scale.linear().domain([0,maxPerDay]).range(["#fff","#f00"]),h=i.selectAll("rect").data(r,function(e){return e.key}),h.enter().append("rect").attr({transform:function(n){return t(a(e(n.key)),0)},height:o,width:c}).style({fill:function(e){return l(e.values.length)}}),h.exit().remove(),n.extent([a.domain()[0],d3.time.day.offset(a.domain()[0],2)]),f=i.selectAll(".brush").data([0]).enter().append("g").attr({"class":"brush"}).call(n),f.selectAll(".resize").remove(),f.selectAll(".background").style({background:"transparent"}),f.selectAll("rect").attr({height:o})}),r},r.width=function(e){return arguments.length?(u=e,r):u},r.height=function(e){return arguments.length?(o=e,r):o},r.domain=function(e){return arguments.length?(s=e,r):s},d3.rebind(r,i,"on"),r}}).call(this);